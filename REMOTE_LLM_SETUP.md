# 自己的大模型配置指南

本文档介绍如何配置应用连接到你们自己的大模型服务（不使用OpenAI）。

## 1. 确定大模型服务器信息

首先，你需要获取以下信息：
- 大模型服务器的IP地址（例如：`192.168.1.100`）
- 大模型服务器的端口号（默认：`8000`）
- 网络连通性（确保两台电脑在同一网络中）

## 2. 修改客户端配置

### 方式1：使用环境变量（推荐）

1. 复制环境变量模板：
```bash
cp .env.example .env
```

2. 编辑 `.env` 文件，修改以下配置：
```env
# 替换为实际的服务器IP地址
LLM_SERVER_URL=ws://192.168.1.100:8000

# 可选：配置备用服务器
LLM_SERVER_BACKUP_1=ws://192.168.1.101:8000
```

### 方式2：直接修改配置文件

编辑 `src/config/llmConfig.js`：
```javascript
responseLLM: {
  websocketUrl: 'ws://192.168.1.100:8000', // 替换为实际IP
  timeout: 60000,
  // ...其他配置
}
```

## 3. 服务器端配置

### 确保大模型服务器正在运行

在大模型服务器上，确保WebSocket服务正在运行：

```bash
# 方式1：使用我们提供的适配器
cd response/
python start_llm_server.py 0.0.0.0 8000

# 方式2：如果有自己的服务
python your_llm_server.py --host 0.0.0.0 --port 8000
```

### 防火墙配置

确保大模型服务器的防火墙允许8000端口的入站连接：

**Linux:**
```bash
sudo ufw allow 8000
# 或
sudo iptables -A INPUT -p tcp --dport 8000 -j ACCEPT
```

**Windows:**
1. 打开Windows防火墙
2. 添加入站规则，允许端口8000
3. 选择TCP协议

**macOS:**
```bash
# 通常macOS默认不会阻止，但可以检查
sudo pfctl -sr
```

## 4. 网络测试

### 测试网络连通性

在客户端电脑上测试连接：
```bash
# 测试ping连通性
ping 192.168.1.100

# 测试端口连通性
telnet 192.168.1.100 8000
# 或使用nc命令
nc -zv 192.168.1.100 8000
```

### WebSocket连接测试

可以使用在线WebSocket测试工具或命令行工具测试：
```bash
# 使用wscat（需要先安装：npm install -g wscat）
wscat -c ws://192.168.1.100:8000
```

## 5. 常见问题排除

### 连接失败
1. **检查IP地址是否正确**
2. **确认端口号匹配**
3. **检查防火墙设置**
4. **确认两台电脑在同一网络**

### 连接不稳定
1. **检查网络质量**
2. **增加超时时间**：在配置中将`timeout`增加到更大值
3. **使用有线网络**：相比WiFi更稳定

### 性能问题
1. **网络延迟**：考虑使用有线连接
2. **服务器性能**：确保大模型服务器有足够的计算资源
3. **并发限制**：避免同时发送过多请求

## 6. 配置示例

完整的配置示例：

```javascript
// src/config/llmConfig.js
responseLLM: {
  websocketUrl: process.env.LLM_SERVER_URL || 'ws://192.168.1.100:8000',
  timeout: 60000, // 60秒超时
  maxTokens: 512,
  
  // 网络配置
  reconnectAttempts: 10,    // 重连次数
  reconnectDelay: 3000,     // 重连间隔
  heartbeatInterval: 30000, // 心跳检测
  
  // 备用服务器
  fallbackServers: [
    'ws://192.168.1.101:8000',
    'ws://192.168.1.102:8000'
  ]
}
```

## 7. 安全建议

1. **内网使用**：仅在可信的内网环境中使用
2. **访问控制**：考虑在服务器端添加IP白名单
3. **加密传输**：生产环境建议使用WSS（WebSocket Secure）
4. **监控日志**：关注连接日志，及时发现异常

## 8. 性能优化

1. **网络优化**：
   - 使用有线网络连接
   - 确保网络带宽充足
   - 减少网络跳数

2. **配置优化**：
   - 合理设置超时时间
   - 启用连接池
   - 配置合适的重连策略

3. **服务器优化**：
   - 确保服务器有足够内存
   - 使用GPU加速推理
   - 优化模型加载策略