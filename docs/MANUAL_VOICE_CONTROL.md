# 手动语音控制功能说明

## 🎯 功能概述

已添加新的手动语音控制功能，用户可以通过按下麦克风按钮主动触发语音输入，替代之前的实时语音检测模式。

## 🎤 使用方法

### 1. 启动智能对话
- 点击"开始对话 🎤"按钮进入智能对话模式

### 2. 手动语音输入
- **蓝色麦克风按钮**：点击开始录音
- **红色停止按钮**：点击停止录音并处理语音
- 按钮文字：
  - 未录音时："按住说话"
  - 录音中："停止录音"

### 3. 交互流程
1. 🎤 **点击麦克风** → AI立即停止说话，开始录音
2. 🗣️ **用户说话** → 录音状态（红色按钮）
3. ⏹️ **点击停止** → 处理语音，识别文字
4. 🤖 **AI回复** → 语音合成播放回答
5. 🔄 **重复循环** → 继续对话

## 🔧 技术实现

### 前端界面 (Voice.js)
```javascript
// 新增状态
const [isManualRecording, setIsManualRecording] = useState(false)

// 麦克风按钮处理
const handleManualMicPress = async () => {
  if (isManualRecording) {
    // 停止录音并处理
    await digitalAssistant.stopManualVoiceRecording()
  } else {
    // 开始录音（立即停止AI输出）
    await digitalAssistant.startManualVoiceRecording()
  }
}
```

### 后端逻辑 (DigitalAssistant.js)
```javascript
// 开始手动录音
async startManualVoiceRecording() {
  // 1. 立即停止AI语音输出
  // 2. 开始录音
  // 3. 设置状态
}

// 停止手动录音
async stopManualVoiceRecording() {
  // 1. 停止录音
  // 2. STT语音识别
  // 3. LLM处理
  // 4. TTS语音合成
}
```

## 🎨 界面设计

### 按钮状态
- **未录音状态**：
  - 背景：蓝色 (#3742fa)
  - 图标：🎤
  - 文字："按住说话"

- **录音状态**：
  - 背景：红色 (#ff4757)  
  - 图标：⏹️
  - 文字："停止录音"

### 布局位置
- 位于智能对话控制按钮下方
- 只在智能对话模式激活时显示
- 居中对齐，独立交互

## ⚡ 关键特性

### 1. 即时中断
- 点击麦克风按钮时，AI**立即停止**当前语音输出
- 避免用户等待AI说完才能输入

### 2. 状态同步
- 按钮颜色和文字实时反映录音状态
- 与DigitalAssistant状态完全同步

### 3. 完整流程
- STT → LLM → TTS 完整语音对话流程
- 支持SenceVoice和标准STT/TTS服务

### 4. 错误处理
- 录音失败、识别失败、处理失败的完整错误处理
- 友好的用户提示信息

## 🔄 与原有功能关系

### 保留功能
- ✅ 智能对话模式开关
- ✅ 原有单次录音功能（非智能模式下）
- ✅ 消息历史记录
- ✅ 状态通知回调

### 新增功能
- ✅ 手动触发录音
- ✅ 主动中断AI输出
- ✅ 按需语音交互

### 替换逻辑
- **原来**：实时语音活动检测（VAD）
- **现在**：用户主动按钮触发
- **优势**：避免误触发，用户完全控制时机

## 🎯 使用场景

1. **精确控制**：用户决定何时说话，避免不必要的打断
2. **噪声环境**：不受环境音影响，只在按键时录音
3. **隐私保护**：只在用户主动按键时才录音
4. **节省资源**：不需要持续的语音活动检测

这种手动控制方式提供了更可靠和用户友好的语音交互体验！